<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>VpasModule • ScriptBuilder</title>
  <link rel="icon" type="image/x-icon" href="images/favicon_theme.ico"/>
  <link rel="stylesheet" href="assets/css/main.css"/>
  <style>
    /* ===== ScriptBuilder page-specific ===== */
	/* Ensure auth pills are white even when not selected */
	.scriptbuilder-page .pills-row .pill,
	.scriptbuilder-page #authPills .pill { color:#fff; }
	.scriptbuilder-page .pills-row .pill:hover,
	.scriptbuilder-page #authPills .pill:hover { color:#fff; }

    .scriptbuilder-page .hero h1 { margin-bottom: 8px; }
    .scriptbuilder-page .step { margin-top: 18px; }
    .scriptbuilder-page .step h3 { margin: 0 0 10px; }
    .scriptbuilder-page .card .card-body > .muted { margin-top: 6px; }
    /* Pill states (ensure contrast on dark bg) */
    .scriptbuilder-page .pills .pill { color: #fff; }
    .scriptbuilder-page .pill[aria-pressed="true"]{
      background: var(--indigo-600);
      border-color: var(--indigo-600);
      color:#fff;
    }

    /* ===== NEW AUTH LAYOUT =====
       Grid: [ main (pills + inputs) | extras ] — NO stacking */
    .scriptbuilder-page .auth-inline {
      display: grid !important;
      grid-template-columns: minmax(560px, 1fr) 360px !important; /* main | extras */
      gap: 12px;
      align-items: start;
    }

    /* Horizontal, single-row pills (scroll if overflow) */
    .scriptbuilder-page .pills-row {
      display:flex;
      gap:8px;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      white-space:nowrap;
      padding-bottom:4px;
    }
    .scriptbuilder-page .pills-row .pill { flex:0 0 auto; }

    /* Inputs directly under pills; 2-up on desktop */
    .scriptbuilder-page .fields-2 { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
    @media (max-width: 760px){ .scriptbuilder-page .fields-2{ grid-template-columns: 1fr; } }

    /* Extras column styling */
    .scriptbuilder-page .auth-extras.card { height: 100%; }
    .scriptbuilder-page .auth-extras .row {
      display:flex; align-items:center; justify-content:space-between; padding:4px 0;
    }
    .scriptbuilder-page .auth-extras .row + .row { border-top:1px dashed var(--border); }

    /* Misc */
    .scriptbuilder-page .code-wrap { position: relative; }
    .scriptbuilder-page .cursor { display:inline-block; width:10px; background: transparent; border-left:2px solid #9aa8ff; animation: blink 1s step-end infinite; }
    @keyframes blink { 50% { border-color: transparent; } }
    .scriptbuilder-page .toolbar-inline { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .scriptbuilder-page .note { font-size:12px; color:var(--muted); }
    .scriptbuilder-page .divider-strong { height:2px; background: var(--border); opacity:.8; margin: 16px 0; }
	
	/* Parameter-set chips (default) */
	#setTabs .btn.btn-chip {
	  background: #0b1118;
	  border: 1px solid #1b2a3b;
	  color: #9fb3c8;
	}

	/* Active/selected parameter-set chip */
	#setTabs .btn.btn-chip.is-active {
	  background: #4f46e5;        /* blue */
	  color: #e7f0fb;             /* light text */
	  box-shadow: 0 0 0 1px #1c58a1 inset;
	}
  </style>
  <style>
	  /* Searchable combo panel */
	  .combo-panel {
		position: absolute; top: 100%; left: 0; right: 0;
		margin-top: 6px; padding: 10px; border-radius: 10px;
		background: #0b1118; border: 1px solid #1b2a3b; z-index: 50;
		box-shadow: 0 8px 24px rgba(0,0,0,.35);
	  }
	  #cmdComboSearch { width: 100%; margin-bottom: 8px; }
	  #cmdComboList { list-style: none; margin: 0; padding: 0; max-height: 260px; overflow: auto; }
	  #cmdComboList li {
		padding: 8px 10px; border-radius: 8px; cursor: pointer;
		color: #e6eef6;
	  }
	  #cmdComboList li:hover, #cmdComboList li.active {
		background: #123b6c; color: #e7f0fb;
	  }
	</style>
  <script>
	const COMMANDS = [
		
		{ 			id:"Add-VPASAccount", 			name:"Add-VPASAccount", 			category:"Accounts", 			tags:["Introduced: v10.10","Version: 9","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to create a new account object", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Add-VPASAccount -platformID <String> -safeName <String> [-accessRestrictedToRemoteMachines <String>] [-remoteMachines <String>] [-automaticManagementEnabled <String>] [-manualManagementReason <String>] [-extraProps <Hashtable>] [-secretType <String>] [-name <String>] -address <String> -username <String> [-secret <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"platformID", type:"String", required:true, description:"PlatformID that will be assigned to the new account", validateSet:[] }, 						{ name:"safeName", type:"String", required:true, description:"SafeName that will be assigned to the new account", validateSet:[] }, 						{ name:"accessRestrictedToRemoteMachines", type:"String", required:false, description:"Limit if the new account can only connect to specific remote machines Possible values: TRUE, FALSE", validateSet:["TRUE","FALSE"] }, 						{ name:"remoteMachines", type:"String", required:false, description:"Specific remote machines that the new account can connect to", validateSet:[] }, 						{ name:"automaticManagementEnabled", type:"String", required:false, description:"Enable for the account to be automatically managed by the CPM depending on platform settings and configurations Possible values: TRUE, FALSE", validateSet:["TRUE","FALSE"] }, 						{ name:"manualManagementReason", type:"String", required:false, description:"Specify a reason for automatic management to be disabled", validateSet:[] }, 						{ name:"extraProps", type:"Hashtable", required:false, description:"Include extra properties that can be defined based on platform settings and configurations Pass extra properties in a hashtable following this pattern: @{ OptionalProperty1Tag = \"OptionalProperty1Value\" } Oracle Example: -extraProps @{ Database = \"VmanDB\" }", validateSet:[] }, 						{ name:"secretType", type:"String", required:false, description:"Type of secret that will be assigned to the new account Possible values: Password, Key", validateSet:["Password","Key"] }, 						{ name:"name", type:"String", required:false, description:"ObjectName that will be assigned to the new account", validateSet:[] }, 						{ name:"address", type:"String", required:true, description:"Address that will be assigned to the new account", validateSet:[] }, 						{ name:"username", type:"String", required:true, description:"Username that will be assigned to the new account", validateSet:[] }, 						{ name:"secret", type:"String", required:false, description:"Secret that will be assigned to the new account", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$CreateAccountJSON = Add-VPASAccount -platformID {PLATFORMID VALUE} -safeName {SAFENAME VALUE} -address {ADDRESS VALUE} -username {USERNAME VALUE} -extraProps @{Database = \"DatabaseName\"; Port = \"1234\"}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Add-VPASAccount -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$InputParameters = @{\n    platformID = \"TargetPlatform\"\n    safeName = \"TargetSafeName\"\n    accessRestrictedToRemoteMachines = \"TRUE\"|\"FALSE\"\n    automaticManagementEnabled = \"TRUE\"|\"FALSE\"\n    manualManagementReason = \"Reason to disable rotation\"\n    extraProps = @{\n        \n        ExtraProperty1 = \"ExtraProperty1Value\"\n        ExtraProperty2 = \"ExtraProperty2Value\"\n\n    }\n    secretType = \"Password\"|\"Key\"\n    address = \"AddressHere\"\n    username = \"UsernameHere\"\n    secret = \"Cyberark1\"\n}\n$CreateAccountJSON = Add-VPASAccount -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"categoryModificationTime\":  1723780054,\n    \"platformId\":  \"WinDomain\",\n    \"safeName\":  \"TestSafe\",\n    \"id\":  \"121_5\",\n    \"name\":  \"Operating System-WinDomain-vman.com-testdomainuser02\",\n    \"address\":  \"vman.com\",\n    \"userName\":  \"testdomainuser02\",\n    \"secretType\":  \"password\",\n    \"secretManagement\":  {\n                             \"automaticManagementEnabled\":  true,\n                             \"lastModifiedTime\":  1723780054\n                         },\n    \"createdTime\":  1723780054\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Find-VPASTargetValue", 			name:"Find-VPASTargetValue", 			category:"Metrics", 			tags:["Introduced: v14.4.1","Version: 5","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to search for a target value in all assets (safes, accounts, platforms, safe members, etc.)", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Find-VPASTargetValue -searchQuery <String> [-SkipSafes] [-SkipAccounts] [-SkipPlatforms] [-SkipEPVUsers] [-SkipEPVGroups] [-SkipApplications] [-SkipRoles] [-SkipIdentities] [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"searchQuery", type:"String", required:true, description:"Search string to find target resource via username, address, safe, platform, etc.", validateSet:[] }, 						{ name:"SkipSafes", type:"", required:false, description:"Flag to ignore safes, getting safe data will be skipped", validateSet:[] }, 						{ name:"SkipAccounts", type:"", required:false, description:"Flag to ignore accounts, getting account data will be skipped", validateSet:[] }, 						{ name:"SkipPlatforms", type:"", required:false, description:"Flag to ignore platforms, getting platform data will be skipped", validateSet:[] }, 						{ name:"SkipEPVUsers", type:"", required:false, description:"Flag to ignore EPVUsers, getting EPVUser data will be skipped", validateSet:[] }, 						{ name:"SkipEPVGroups", type:"", required:false, description:"Flag to ignore EPVGroups, getting EPVGroup data will be skipped", validateSet:[] }, 						{ name:"SkipApplications", type:"", required:false, description:"Flag to ignore applications, getting applicationID data will be skipped", validateSet:[] }, 						{ name:"SkipRoles", type:"", required:false, description:"Flag to ignore roles, getting role data will be skipped", validateSet:[] }, 						{ name:"SkipIdentities", type:"", required:false, description:"Flag to ignore identities, getting identity data will be skipped", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$Output = Find-VPASTargetValue -searchQuery {SEARCHQUERY VALUE}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Find-VPASTargetValue -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$InputParameters = @{\n    searchQuery = $true|$false\n    SkipSafes = $true|$false\n    SkipAccounts = $true|$false\n    SkipPlatforms = $true|$false\n    SkipEPVUsers = $true|$false\n    SkipEPVGroups = $true|$false\n    SkipApplications = $true|$false\n    SkipRoles = $true|$false\n    SkipIdentities = $true|$false\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$Output = Find-VPASTargetValue -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"ExtraInfo\":  {\n                      \"categoryModificationTime\":  1755487502,\n                      \"platformId\":  \"WinDomain\",\n                      \"safeName\":  \"TestSafe\",\n                      \"id\":  \"121_1088\",\n                      \"name\":  \"Operating System-WinDomain-vman.com-TestAPIAccount01\",\n                      \"address\":  \"vman.com\",\n                      \"userName\":  \"TestAPIAccount01\",\n                      \"secretType\":  \"password\",\n                      \"platformAccountProperties\":  {\n\n                                                    },\n                      \"secretManagement\":  {\n                                               \"automaticManagementEnabled\":  false,\n                                               \"manualManagementReason\":  \"Testing API Limits\",\n                                               \"lastModifiedTime\":  1755487501\n                                           },\n                      \"createdTime\":  1755487501\n                  },\n    \"Condition\":  \"TestAPIAccount01 matched on account name: Operating System-WinDomain-vman.com-TestAPIAccount01\",\n    \"Asset\":  \"Account\",\n    \"Value\":  \"Operating System-WinDomain-vman.com-TestAPIAccount01\"\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Get-VPASAccountActivity", 			name:"Get-VPASAccountActivity", 			category:"Accounts", 			tags:["Introduced: v10.10","Version: 7","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to retrieve the activity of an account", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Get-VPASAccountActivity [-safe <String>] [-platform <String>] [-username <String>] [-address <String>] [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"safe", type:"String", required:false, description:"Safe name that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"platform", type:"String", required:false, description:"PlatformID that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"username", type:"String", required:false, description:"Username that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"address", type:"String", required:false, description:"Address that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$AccountActivityJSON = Get-VPASAccountActivity -safe {SAFE VALUE} -username {USERNAME VALUE} -platform {PLATFORM VALUE} -address {ADDRESS VALUE}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Get-VPASAccountActivity -AcctID <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"AcctID", type:"String", required:true, description:"Unique ID that maps to a single account, passing this variable will skip any query functions", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$AccountActivityJSON = Get-VPASAccountActivity -AcctID {ACCTID VALUE}" } 					] 				}, 				{ 					name:"ParameterSet3", 					syntax:"Get-VPASAccountActivity -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    safe = \"TargetSafe\"platform = \"TargetPlatformID\"username = \"TargetUsername\"\n    address = \"TargetAddress\"\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountActivityJSON = Get-VPASAccountActivity -InputParameters $InputParameters" }, 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    AcctID = \"22_123\"\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountActivityJSON = Get-VPASAccountActivity -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"Activities\":  [\n                       {\n                           \"Alert\":  false,\n                           \"Date\":  1723776151,\n                           \"User\":  \"vman@cyberark.cloud.1234\",\n                           \"Action\":  \"Get File Request\",\n                           \"ActionID\":  109,\n                           \"ClientID\":  \"PVWA\",\n                           \"MoreInfo\":  \"\",\n                           \"Reason\":  \"(ConnectionClient=PSM-RDP) Testing Account Request [From 8/16/2024 1:00:00 PM to 8/16/2024 5:00:00 PM  multiple operations]\"\n                       },\n                       {\n                           \"Alert\":  true,\n                           \"Date\":  1716701723,\n                           \"User\":  \"vman@cyberark.cloud.1234\",\n                           \"Action\":  \"Retrieve File\",\n                           \"ActionID\":  43,\n                           \"ClientID\":  \"PVWA\",\n                           \"MoreInfo\":  \"\",\n                           \"Reason\":  \"\"\n                       },\n                       {\n                           \"Alert\":  false,\n                           \"Date\":  1715651891,\n                           \"User\":  \"normaluser@vman.com\",\n                           \"Action\":  \"Get File Request\",\n                           \"ActionID\":  109,\n                           \"ClientID\":  \"PVWA\",\n                           \"MoreInfo\":  \"\",\n                           \"Reason\":  \"testing bulk request via apis [From 5/14/2024 1:58:11 AM to 6/13/2024 1:58:11 AM ]\"\n                       },\n                       {\n                           \"Alert\":  false,\n                           \"Date\":  1715222731,\n                           \"User\":  \"vadim@vman.pam\",\n                           \"Action\":  \"Retrieve password\",\n                           \"ActionID\":  295,\n                           \"ClientID\":  \"PVWA\",\n                           \"MoreInfo\":  \"\",\n                           \"Reason\":  \"(Action: Show Password)\"\n                       }\n                   ],\n    \"Total\":  4\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Get-VPASAccountCompliance", 			name:"Get-VPASAccountCompliance", 			category:"Accounts", 			tags:["Introduced: v14.4.1","Version: 5","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to retrieve the compliance status of accounts based on a search query", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Get-VPASAccountCompliance [-safe <String>] [-platform <String>] [-username <String>] [-address <String>] [-ExactMatch] [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"safe", type:"String", required:false, description:"Safe name that will be used to query for the target accounts if no AcctID is passed", validateSet:[] }, 						{ name:"platform", type:"String", required:false, description:"PlatformID that will be used to query for the target accounts if no AcctID is passed", validateSet:[] }, 						{ name:"username", type:"String", required:false, description:"Username that will be used to query for the target accounts if no AcctID is passed", validateSet:[] }, 						{ name:"address", type:"String", required:false, description:"Address that will be used to query for the target accounts if no AcctID is passed", validateSet:[] }, 						{ name:"ExactMatch", type:"", required:false, description:"Returns accounts that match search query exactly (not a wildcard search)", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$ComplianceStatus = Get-VPASAccountCompliance -safe {SAFE VALUE} -platform {PLATFORM VALUE} -address {ADDRESS VALUE} -username {USRNAME VALUE} -ExactMatch" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Get-VPASAccountCompliance -AcctID <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"AcctID", type:"String", required:true, description:"Unique ID that maps to a single account, passing this variable will skip any query functions", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$ComplianceStatus = Get-VPASAccountCompliance -AcctID {ACCTID VALUE}" } 					] 				}, 				{ 					name:"ParameterSet3", 					syntax:"Get-VPASAccountCompliance -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    AcctID = 3_12\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$ComplianceStatus = Get-VPASAccountCompliance -InputParameters $InputParameters" }, 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    safe = \"TargetSafeName\"\n    platform = \"TargetPlatformID\"\n    username = \"TargetUsername\"\n    address = \"TargetAddress\"\n    ExactMatch = $true|$false\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$ComplianceStatus = Get-VPASAccountCompliance -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"value\":  [\n                  {\n                      \"IsCompliant\":  false,\n                      \"AccountID\":  \"121_3\",\n                      \"Safe\":  \"TestSafe\",\n                      \"Address\":  \"testdomain.com\",\n                      \"Username\":  \"testdomainuser01\",\n                      \"PlatformID\":  \"WinDomain\",\n                      \"Name\":  \"Operating System-WinDomain-testdomain.com-testdomainuser01\",\n                      \"LastUsedBy\":  \"vman@vman.com\",\n                      \"LastUsedDate\":  1716701771\n                  },\n                  {\n                      \"IsCompliant\":  true,\n                      \"AccountID\":  \"35_215\",\n                      \"Safe\":  \"VadimTestSafe\",\n                      \"Address\":  \"AddressHere\",\n                      \"Username\":  \"UsernameHere\",\n                      \"PlatformID\":  \"WinDomain\",\n                      \"Name\":  \"Operating System-WinDomain-AddressHere-UsernameHere\",\n                      \"LastUsedBy\":  \"vman@cyberark.cloud.1234\",\n                      \"LastUsedDate\":  1726373536\n                  }\n              ]\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Get-VPASAccountDetails", 			name:"Get-VPASAccountDetails", 			category:"Accounts", 			tags:["Introduced: v10.10","Version: 10","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to retrieve the details of an account", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Get-VPASAccountDetails [-safe <String>] [-platform <String>] [-username <String>] [-address <String>] [-ExactMatch] [-HideWarning] [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"safe", type:"String", required:false, description:"Safe name that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"platform", type:"String", required:false, description:"PlatformID that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"username", type:"String", required:false, description:"Username that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"address", type:"String", required:false, description:"Address that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"ExactMatch", type:"", required:false, description:"Returns accounts that match search query exactly (not a wildcard search)", validateSet:[] }, 						{ name:"HideWarning", type:"", required:false, description:"Hide any warning outputs from the console during the API session", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$AccountDetailsJSON = Get-VPASAccountDetails -safe {SAFE VALUE} -username {USERNAME VALUE}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Get-VPASAccountDetails -AcctID <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"AcctID", type:"String", required:true, description:"Unique ID that maps to a single account, passing this variable will skip any query functions", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$AccountDetailsJSON = Get-VPASAccountDetails -AcctID {ACCTID VALUE}" } 					] 				}, 				{ 					name:"ParameterSet3", 					syntax:"Get-VPASAccountDetails -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet3", code:"$AccountDetailsJSON = Get-VPASAccountDetails -SavedFilter {SAVED FILTER VALUE}" } 					] 				}, 				{ 					name:"ParameterSet4", 					syntax:"Get-VPASAccountDetails -SavedFilter <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"SavedFilter", type:"String", required:true, description:"Returns accounts based on a prebuilt search query Possible values: \"Regular\", \"Recently\", \"New\", \"Link\", \"Deleted\", \"PolicyFailures\", \"AccessedByUsers\", \"ModifiedByUsers\", \"ModifiedByCPM\", \"DisabledPasswordByUser\", \"DisabledPasswordByCPM\", \"ScheduledForChange\", \"ScheduledForVerify\", \"ScheduledForReconcile\", \"SuccessfullyReconciled\", \"FailedChange\", \"FailedVerify\", \"FailedReconcile\", \"LockedOrNew\", \"Locked\", \"Favorites\"", validateSet:["Regular","Recently","New","Link","Deleted","PolicyFailures","AccessedByUsers","ModifiedByUsers","ModifiedByCPM","DisabledPasswordByUser","DisabledPasswordByCPM","ScheduledForChange","ScheduledForVerify","ScheduledForReconcile","SuccessfullyReconciled","FailedChange","FailedVerify","FailedReconcile","LockedOrNew","Locked","Favorites"] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet4", code:"$InputParameters = @{\n    AcctID = 3_12\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountDetailsJSON = Get-VPASAccountDetails -InputParameters $InputParameters" }, 						{ caption:"ParameterSet4", code:"$InputParameters = @{\n    safe = \"TargetSafeName\"\n    platform = \"TargetPlatformID\"\n    username = \"TargetUsername\"\n    address = \"TargetAddress\"\n    ExactMatch = $true|$false\n    HideWarning = $true|$false\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountDetailsJSON = Get-VPASAccountDetails -InputParameters $InputParameters" }, 						{ caption:"ParameterSet4", code:"$InputParameters = @{\n    SavedFilter = \"Regular\"|\"Recently\"|\"New\"|\"Link\"|\"Deleted\"|\"PolicyFailures\"|\"AccessedByUsers\"|\"ModifiedByUsers\"|\"ModifiedByCPM\"|\"DisabledPasswordByUser\"|\"DisabledPasswordByCPM\"|\"ScheduledForChange\"|\"ScheduledForVerify\"|\"ScheduledForReconcile\"|\"SuccessfullyReconciled\"|\"FailedChange\"|\"FailedVerify\"|\"FailedReconcile\"|\"LockedOrNew\"|\"Locked\"|\"Favorites\"\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountDetailsJSON = Get-VPASAccountDetails -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"categoryModificationTime\":  1715701023,\n    \"platformId\":  \"VPASDualControl\",\n    \"safeName\":  \"VPASRequestSafe\",\n    \"id\":  \"120_3\",\n    \"name\":  \"Operating System-VPASDualControl-vman.com-DomainAdmin01\",\n    \"address\":  \"vman.com\",\n    \"userName\":  \"DomainAdmin011\",\n    \"secretType\":  \"password\",\n    \"secretManagement\":  {\n                             \"automaticManagementEnabled\":  true,\n                             \"lastModifiedTime\":  1715222718\n                         },\n    \"createdTime\":  1715222718\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Get-VPASAccountDetailsExtended", 			name:"Get-VPASAccountDetailsExtended", 			category:"Accounts", 			tags:["Introduced: v14.4.1","Version: 4","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to retrieve extended details for an account", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Get-VPASAccountDetailsExtended [-safe <String>] [-platform <String>] [-username <String>] [-address <String>] [-ExactMatch] [-HideWarning] [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"safe", type:"String", required:false, description:"Safe name that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"platform", type:"String", required:false, description:"PlatformID that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"username", type:"String", required:false, description:"Username that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"address", type:"String", required:false, description:"Address that will be used to query for the target account if no AcctID is passed", validateSet:[] }, 						{ name:"ExactMatch", type:"", required:false, description:"Returns accounts that match search query exactly (not a wildcard search)", validateSet:[] }, 						{ name:"HideWarning", type:"", required:false, description:"Hide any warning outputs from the console during the API session", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$AccountDetailsExtendedJSON = Get-VPASAccountDetailsExtended -safe {SAFE VALUE} -username {USERNAME VALUE}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Get-VPASAccountDetailsExtended -AcctID <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"AcctID", type:"String", required:true, description:"Unique ID that maps to a single account, passing this variable will skip any query functions", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$AccountDetailsExtendedJSON = Get-VPASAccountDetailsExtended -AcctID {ACCTID VALUE}" } 					] 				}, 				{ 					name:"ParameterSet3", 					syntax:"Get-VPASAccountDetailsExtended -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    AcctID = 3_12\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountDetailsExtendedJSON = Get-VPASAccountDetailsExtended -InputParameters $InputParameters" }, 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    safe = \"TargetSafeName\"\n    platform = \"TargetPlatformID\"\n    username = \"TargetUsername\"\n    address = \"TargetAddress\"\n    ExactMatch = $true|$false\n    HideWarning = $true|$false\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountDetailsExtendedJSON = Get-VPASAccountDetailsExtended -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"Compliance\":  {\n                       \"IsCompliant\":  false,\n                       \"LastModifiedDate\":  1715222718,\n                       \"LastModifiedBy\":  \"vadim@vman.com\",\n                       \"ModificationType\":  \"Change\"\n                   },\n    \"Activities\":  [\n                       {\n                           \"Alert\":  false,\n                           \"Date\":  1735008158,\n                           \"User\":  \"vpasuser@vman.com\",\n                           \"Action\":  \"Get File Request\",\n                           \"ActionID\":  109,\n                           \"ClientID\":  \"PVWA\",\n                           \"MoreInfo\":  \"\",\n                           \"Reason\":  \"give me access From 12/24/2024 2:42:38 AM to 1/23/2025 2:42:38 AM\"\n                       }\n                   ],\n    \"TotalDependencies\":  0,\n    \"FailedDependencies\":  0,\n    \"Recordings\":  null,\n    \"Details\":  {\n                    \"LastVerifiedDate\":  0,\n                    \"LastVerifiedBy\":  null,\n                    \"LastUsedBy\":  \"vadim@vman.com\",\n                    \"LastUsedDate\":  1715222731,\n                    \"CreationDate\":  1715222718,\n                    \"Name\":  \"Operating System-VPASDualControl-vman.com-DomainAdmin01\",\n                    \"CreatedTime\":  1715222718,\n                    \"AccountURL\":  null,\n                    \"ManagedByCPM\":  true,\n                    \"CPMDisabled\":  \"\",\n                    \"CPMStatus\":  null,\n                    \"CPMErrorDetails\":  \"\",\n                    \"ImmediateCPMTask\":  null,\n                    \"DeletedBy\":  \"\",\n                    \"DeletionDate\":  0,\n                    \"LockedBy\":  \"\",\n                    \"IsFavorite\":  false,\n                    \"IsNew\":  false,\n                    \"SafeName\":  \"VPASRequestSafe\",\n                    \"IsGroupMember\":  false,\n                    \"DualControlStatus\":  \"RequestNeeded\",\n                    \"RequiredProperties\":  {\n                                               \"Address\":  \"vman.com\",\n                                               \"Username\":  \"DomainAdmin01\"\n                                           },\n                    \"OptionalProperties\":  null,\n                    \"LimitDomainAccess\":  \"\",\n                    \"AccessDomainList\":  \"\",\n                    \"RequestId\":  -1,\n                    \"FutureTimeFrame\":  false,\n                    \"LinkedAccounts\":  null\n                },\n    \"Platform\":  {\n                     \"VerificationPeriod\":  7,\n                     \"ExpirationPeriod\":  90,\n                     \"HeadStartInterval\":  5,\n                     \"PlatformID\":  \"VPASDualControl\",\n                     \"PlatformName\":  \"VPASDualControl\",\n                     \"IsActive\":  true\n                 },\n    \"AvailableTabs\":  [\n                          \"Activities\",\n                          \"Dependencies\"\n                      ],\n    \"ActionsToDisplay\":  null\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,
		{ 			id:"Get-VPASAccountGroupMembers", 			name:"Get-VPASAccountGroupMembers", 			category:"Account Groups", 			tags:["Introduced: v10.10","Version: 8","SelfHosted","PrivCloudStandard","SharedServices"], 			description:"Use this function to retrieve the group members of an account group", 			parameterSets:[ 				{ 					name:"ParameterSet1", 					syntax:"Get-VPASAccountGroupMembers -GroupID <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"GroupID", type:"String", required:true, description:"Unique ID that maps to the target AccountGroup Supply GroupID to skip any querying for target AccountGroup", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet1", code:"$AccountGroupMembersJSON = Get-VPASAccountGroupMembers -GroupID {GROUPID VALUE}" } 					] 				}, 				{ 					name:"ParameterSet2", 					syntax:"Get-VPASAccountGroupMembers -safe <String> -GroupName <String> [-ExportToCSV] [-CSVDirectory <String>] [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"safe", type:"String", required:true, description:"Target unique safe name", validateSet:[] }, 						{ name:"GroupName", type:"String", required:true, description:"Unique target GroupName that will be used to query for the GroupID if no GroupID is passed An account group is set of accounts that will have the same password synced across the entire group", validateSet:[] }, 						{ name:"ExportToCSV", type:"", required:false, description:"Output results to a CSV file found in AppData\Local\VPASModuleOutputs directory", validateSet:[] }, 						{ name:"CSVDirectory", type:"String", required:false, description:"Output directory where the exported CSV file will be saved to Default value: C:\Users\{CurrentUser}\AppData\Local\VPASModuleOutputs\ExportedCSVs", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet2", code:"$AccountGroupMembersJSON = Get-VPASAccountGroupMembers -GroupName {GROUPNAME VALUE} -safe {SAFE VALUE}" } 					] 				}, 				{ 					name:"ParameterSet3", 					syntax:"Get-VPASAccountGroupMembers -InputParameters <Hashtable> [-token <Hashtable>] [<CommonParameters>]", 					parameters:[ 						{ name:"InputParameters", type:"Hashtable", required:true, description:"HashTable of values containing the parameters required to make the API call", validateSet:[] }, 						{ name:"token", type:"Hashtable", required:false, description:"HashTable of data containing various pieces of login information (PVWA, LoginToken, HeaderType, etc). If -token is not passed, function will use last known hashtable generated by New-VPASToken", validateSet:[] } 					], 					examples:[ 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    GroupID = \"12_123\"\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountGroupMembersJSON = Get-VPASAccountGroupMembers -InputParameters $InputParameters" }, 						{ caption:"ParameterSet3", code:"$InputParameters = @{\n    safe = \"TargetSafe\"GroupName = \"VpasGroupTest\"\n    ExportToCSV = $true|$false\n    CSVDirectory = \"C:\\\\Temp\"\n}\n$AccountGroupMembersJSON = Get-VPASAccountGroupMembers -InputParameters $InputParameters" } 					] 				}, 			], 			output:[ 				{ caption: "Success", code:"{\n    \"AccountID\":  \"35_33\",\n    \"SafeName\":  \"VadimTestSafe\",\n    \"PlatformID\":  \"VadimWindowsDomain\",\n    \"Address\":  \"vman.com\",\n    \"UserName\":  \"GroupMemberA\"\n}\n\n{\n    \"AccountID\":  \"35_34\",\n    \"SafeName\":  \"VadimTestSafe\",\n    \"PlatformID\":  \"WinDomain\",\n    \"Address\":  \"vman.com\",\n    \"UserName\":  \"GroupMemberB\"\n}" }, 				{ caption: "Fail", code:"$false" } 			] 		} ,

	];
  </script>
</head>
<body class="scriptbuilder-page">
<header style="background-color:#000;">
  <div class="container nav" style="align-items:center; padding:8px 0;">
    <a class="brand" href="index.html" style="display:flex;align-items:center;gap:50px;text-decoration:none;">
      <div class="logo" style="background:none;padding:0;">
        <img src="images/VpasModuleLOGONoText_theme.png" alt="VPASModule logo" style="height:68px;display:block;"/>
      </div>
      <div style="margin-left:10px;">
        <div class="name" style="font-weight:700;color:#fff;">VpasModule</div>
        <div class="muted" style="font-size:12px;color:#ccc;">PowerShell module for CyberArk APIs</div>
      </div>
    </a>
    <button class="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobilemenu">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 7h16v2H4V7zm0 5h16v2H4v-2zm0 5h16v2H4v-2z"/></svg>
    </button>
    <nav class="navlinks">
      <a href="index.html">Home</a>
      <a href="install.html">Install</a>
      <a href="commands.html">Commands</a>
      <a class="active" href="scriptbuilder.html">ScriptBuilder</a>
      <a href="common.html">Common Scripts</a>
      <a href="updates.html">Updates</a>
      <a href="about.html">About</a>
      <a href="https://docs.cyberark.com" rel="noopener" target="_blank">Docs</a>
    </nav>
  </div>
</header>

<nav id="mobilemenu" class="mobilemenu" role="navigation" aria-label="Mobile menu">
  <div class="container panel">
    <div class="row">
      <a href="index.html">Home</a>
      <a href="install.html">Install</a>
      <a href="commands.html">Commands</a>
      <a href="scriptbuilder.html">ScriptBuilder</a>
      <a href="common.html">Common Scripts</a>
      <a href="updates.html">Updates</a>
      <a href="about.html">About</a>
      <a href="https://docs.cyberark.com" target="_blank" rel="noopener">Docs</a>
    </div>
  </div>
</nav>

<main class="section">
  <div class="container">
    <section class="hero">
      <h1 class="gradient">Script Builder</h1>
      <p class="muted">Fill in your auth, pick a command, set parameters, then <strong>Generate Script</strong> to see it typed out. Copy/paste straight into PowerShell.</p>
    </section>
	<section id="betaDisclaimer" class="banner banner-warning" role="note" aria-live="polite">
	  <div class="banner-text">
		<strong>***DISCLAIMER***</strong><br><br>This utility is currently in beta version and is provided for testing and evaluation purposes only. While I have made every effort to ensure its accuracy and functionality, it may still contain bugs, inaccuracies, or incomplete features<br><br>Please use this utility as a guide and not as a definitive source of information. I do not guarantee the accuracy, completeness, or reliability of the results generated by this tool. Please verify the output independently. Thank you for your understanding and cooperation!
	  </div>
	</section>

    <!-- Step 1: Authentication -->
    <section class="step" id="step-auth">
      <div class="card">
        <div class="card-body">
          <h3>Step 1 — Authentication</h3>
          <div class="muted">Choose an auth type, then provide the fields below. Extras are optional.</div>
          <div class="divider"></div>

          <div class="auth-inline">
            <!-- LEFT: pills + inputs -->
            <div class="auth-main">
              <div class="pills-row" id="authPills" role="tablist" aria-label="Authentication Type">
                <!-- JS injects buttons here -->
              </div>

              <div class="fields fields-2" style="margin-top:8px">
                <div>
                  <label class="label" for="pvwa">PVWA URL</label>
                  <input id="pvwa" class="input" placeholder="mypvwa.domain.com" autocomplete="url"/>
                </div>
                <div>
                  <label class="label" for="identityUrl">Identity URL (optional)</label>
                  <input id="identityUrl" class="input" placeholder="AA1234.id.cyberark.cloud" autocomplete="url"/>
                </div>
                <div>
                  <label class="label" for="idpLogin">IdP Login Path (optional)</label>
                  <input id="idpLogin" class="input" placeholder="https://idplogin/app/appName/123abc/..."/>
                </div>
              </div>
            </div>

            <!-- RIGHT: Extras -->
            <aside class="auth-extras card">
              <div class="card-body">
                <label class="label">Extras</label>
                <div class="row"><span>HideAscii</span><input type="checkbox" id="optHideAscii"></div>
                <div class="row"><span>NoSSL</span><input type="checkbox" id="optNoSSL"></div>
                <div class="row"><span>InitiateCookie</span><input type="checkbox" id="optCookie"></div>
                <div class="row"><span>TextRecorder</span><input type="checkbox" id="optTextRec"></div>
                <div class="row"><span>HideWarnings</span><input type="checkbox" id="optHideWarn"></div>
              </div>
            </aside>
          </div>
        </div>
      </div>
    </section>

    <!-- Step 2: Command & Parameters -->
    <section class="step" id="step-command">
      <div class="card">
        <div class="card-body">
          <h3>Step 2 — Select Command & Fill Parameters</h3>
          <div class="toolbar-inline">
            <label class="label" for="cmdSelect" style="margin:0">Command</label>
			<div id="cmdCombo" class="combo" style="display:none; position:relative;">
			  <button id="cmdComboBtn" type="button" class="input"
					  aria-haspopup="listbox" aria-expanded="false" aria-controls="cmdComboPanel"
					  style="min-width:350px; text-align:left;">
				Select command…
			  </button>

			  <div id="cmdComboPanel" class="combo-panel" hidden>
				<input id="cmdComboSearch" class="input" placeholder="Search commands…" autocomplete="off" />
				<ul id="cmdComboList" role="listbox" tabindex="-1"></ul>
			  </div>
			</div>
			
            <select id="cmdSelect" class="input" style="min-width:260px"></select>
          </div>

          <div id="paramSets" class="section" style="display:none">
            <div class="section-header">
              <div class="tabs" id="setTabs"></div>
            </div>
            <div id="paramForm" class="fields" style="margin-top:10px"></div>
          </div>

          <div id="manualCmd" class="section" style="display:none">
            <div class="fields">
              <div>
                <label class="label" for="manualName">Command Name</label>
                <input id="manualName" class="input" placeholder="Add-VPASAccount"/>
              </div>
              <div>
                <label class="label">Parameters</label>
                <div id="kvManual" class="kv-2"></div>
                <button type="button" id="addParam" class="btn btn-chip" style="margin-top:8px">Add Parameter</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Step 3: Generate -->
    <section class="step" id="step-generate">
      <div class="card">
        <div class="card-body">
          <h3>Step 3 — Generate Script</h3>
          <div class="toolbar-inline">
            <button type="button" id="btnGenerate" class="btn btn-primary">Generate Script</button>
            <button type="button" id="btnReset" class="btn btn-ghost">Reset</button>
            <span id="genStatus" class="note"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Step 4: Output -->
    <section class="step" id="step-output">
      <div class="card">
        <div class="card-body">
          <h3>Step 4 — Display Script</h3>
          <div class="code code-wrap" id="outputCode">
            <button class="copy-icon" id="copyBtn" title="Copy">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
            <pre id="scriptOut"></pre>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<footer>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
    <div><strong>VpasModule</strong><div class="muted" style="margin-top:6px">© <span id="year"></span> Vadim Melamed • <a href="https://github.com/vmelamed5/VpasModule/blob/VpasModule/LICENSE.md" rel="noopener" target="_blank">MIT License</a></div></div>
    <div style="display:flex;gap:8px">
      <a class="btn btn-chip" href="https://github.com/vmelamed5/VpasModule" rel="noopener" target="_blank">
        <svg fill="currentColor" height="16" style="margin-right:6px" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 .5C5.65.5.5 5.65.5 12c0 5.1 3.29 9.41 7.86 10.94.58.11.79-.25.79-.56v-2.02c-3.2.7-3.87-1.39-3.87-1.39-.53-1.34-1.3-1.7-1.3-1.7-1.06-.72.08-.71.08-.71 1.17.08 1.78 1.2 1.78 1.2 1.04 1.77 2.72 1.26 3.38.96.1-.76.41-1.26.74-1.55-2.55-.29-5.23-1.28-5.23-5.69 0-1.26.45-2.3 1.19-3.12-.12-.29-.52-1.45.11-3.01 0 0 .97-.31 3.19 1.19a11.1 11.1 0 0 1 5.8 0c2.22-1.5 3.18-1.19 3.18-1.19.64 1.56.24 2.72.12 3.01.74.82 1.19 1.86 1.19 3.12 0 4.42-2.69 5.39-5.25 5.67.42.36.79 1.08.79 2.19v3.24c0 .31.21.68.8.56A10.96 10.96 0 0 0 23.5 12C23.5 5.65 18.35.5 12 .5Z"></path>
        </svg>
        GitHub
      </a>
      <a class="btn btn-chip" href="https://www.powershellgallery.com/packages/VpasModule/" rel="noopener" target="_blank">
        <svg height="18" style="margin-right:6px" viewBox="0 0 32 32" width="18" xmlns="http://www.w3.org/2000/svg">
          <rect fill="#0273B3" height="32" rx="4" width="32"></rect>
          <path d="M7 23l7-14c.3-.7 1.1-1 1.8-.7.7.3 1 1.1.7 1.8l-7 14c-.3.7-1.1 1-1.8.7-.7-.3-1-1.1-.7-1.8Zm6 2h10c.6 0 1-.4 1-1s-.4-1-1-1H13c-.6 0-1 .4-1 1s.4 1 1 1Z" fill="#fff"></path>
        </svg>
        PS Gallery
      </a>
      <a class="btn btn-chip" href="about.html">
        <svg fill="currentColor" height="16" style="margin-right:6px" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 
                3.99 4 6.5 4c1.74 0 3.41 1.01 
                4.13 2.44h1.74C14.09 5.01 15.76 4 
                17.5 4 20.01 4 22 6 22 8.5c0 
                3.78-3.4 6.86-8.55 11.54L12 
                21.35z"></path>
        </svg>
        Support
      </a>
    </div>
  </div>
</footer>

<script>
(function(){ 
  // Mobile nav
  var btn = document.querySelector('.menu-toggle');
  var mm = document.getElementById('mobilemenu');
  if(btn && mm){
    function closeMenu(){ document.body.classList.remove('menu-open'); btn.setAttribute('aria-expanded','false'); }
    function openMenu(){ document.body.classList.add('menu-open'); btn.setAttribute('aria-expanded','true'); }
    btn.addEventListener('click', function(){ var open = document.body.classList.contains('menu-open'); open ? closeMenu() : openMenu(); });
    document.addEventListener('keydown', function(e){ if(e.key==='Escape') closeMenu(); });
    mm.addEventListener('click', function(e){ if(e.target.tagName==='A') closeMenu(); });
  }
  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>

<script>
(() => {
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));


  // ---- Step 1: Auth ----
  const AUTH_TYPES = ['CyberArk','LDAP','Radius','Windows','SAML','ISPSS_CyberArk','ISPSS_Oauth'];
  const authPills = $('#authPills');
  let activeAuth = AUTH_TYPES[0];

  function setFieldState(input, cfg){
    const {show=true, enable=true} = (cfg || {});
    if (!input) return;
    const wrap = input.closest('div');
    if (wrap) wrap.style.display = show ? '' : 'none';
    input.disabled = !enable;
  }
  function updateAuthFields(){
    const pvwa = document.getElementById('pvwa');
    const identityUrl = document.getElementById('identityUrl');
    const idpLogin = document.getElementById('idpLogin');
    const a = (activeAuth || '').toLowerCase();

    if (['cyberark','radius','ldap','windows'].includes(a)){
      setFieldState(pvwa, {show:true, enable:true});
      setFieldState(identityUrl, {show:false, enable:false});
      setFieldState(idpLogin, {show:false, enable:false});
    } else if (a === 'saml'){
      setFieldState(pvwa, {show:true, enable:true});
      setFieldState(idpLogin, {show:true, enable:true});
      setFieldState(identityUrl, {show:false, enable:false});
    } else if (a.startsWith('ispss')){
      setFieldState(pvwa, {show:true, enable:true});
      setFieldState(identityUrl, {show:true, enable:true});
      setFieldState(idpLogin, {show:false, enable:false});
    } else {
      setFieldState(pvwa, {show:true, enable:true});
      setFieldState(identityUrl, {show:true, enable:true});
      setFieldState(idpLogin, {show:true, enable:true});
    }
  }

  AUTH_TYPES.forEach((t,i) => {
    const b = document.createElement('button');
    b.type='button'; b.className='pill'; b.textContent=t;
    b.setAttribute('role','tab');
    b.setAttribute('aria-pressed', i===0 ? 'true':'false');
    b.addEventListener('click', () => {
      activeAuth = t;
      $$('#authPills .pill').forEach(el => el.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      updateAuthFields();
    });
    authPills.appendChild(b);
  });
  updateAuthFields();

  // ---- Step 2: Commands & Parameters ----
  const select = $('#cmdSelect');
  const paramSetsEl = $('#paramSets');
  const setTabsEl = $('#setTabs');
  const paramFormEl = $('#paramForm');
  const manualCmd = $('#manualCmd');
  const kvManual = $('#kvManual');
  
	var cmdCombo       = document.getElementById('cmdCombo');
	var cmdComboBtn    = document.getElementById('cmdComboBtn');
	var cmdComboPanel  = document.getElementById('cmdComboPanel');
	var cmdComboSearch = document.getElementById('cmdComboSearch');
	var cmdComboList   = document.getElementById('cmdComboList');

	var COMBO_ALL = [];      // full list of commands (sorted)
	var COMBO_VIEW = [];     // filtered view
	var comboOpen = false;
	var comboActiveIndex = -1;

  function getCommands(){
    try { return (typeof COMMANDS !== 'undefined') ? COMMANDS : (window.COMMANDS || null); }
    catch(e){ return window.COMMANDS || null; }
  }

  function ensureCommandOptions(){
    const data = getCommands();
    select.innerHTML = '';
    const opt = (v,txt) => `<option value="${v}">${txt}</option>`;

    if (Array.isArray(data) && data.length) {
      const sorted = [...data].sort((a,b)=> (a.name||'').localeCompare(b.name||''));
      sorted.forEach(c => select.insertAdjacentHTML('beforeend', opt(c.id || c.name, c.name)));
      paramSetsEl.style.display = '';
      manualCmd.style.display = 'none';
		if (cmdCombo) cmdCombo.style.display = '';
		if (select)   select.style.display   = 'none';
		 comboEnsureAll();
    } else {
		if (cmdCombo) cmdCombo.style.display = 'none';
		if (select)   select.style.display   = 'none'; // we keep manual mode visible instead
      paramSetsEl.style.display = 'none';
      manualCmd.style.display = '';
      if (!kvManual.children.length) addManualRow();
    }
  }
  
  function comboSetButtonLabel(byValue){
	  // Find command by current select value (or first in view)
	  var v = typeof byValue === 'string' ? byValue : select.value;
	  var c = null;
	  var list = COMBO_ALL;
	  for (var i=0; i<list.length; i++){
		if ((list[i].id || list[i].name) === v || list[i].name === v){ c = list[i]; break; }
	  }
	  if (!c && COMBO_VIEW.length) c = COMBO_VIEW[0];
	  cmdComboBtn.textContent = c ? (c.name || c.id || 'Select command…') : 'Select command…';
	}

	function comboRenderList(list){
	  cmdComboList.innerHTML = '';
	  for (var i=0; i<list.length; i++){
		var li = document.createElement('li');
		li.setAttribute('role','option');
		li.setAttribute('data-value', list[i].id || list[i].name);
		li.textContent = list[i].name;
		cmdComboList.appendChild(li);
	  }
	  comboActiveIndex = list.length ? 0 : -1;
	  if (list.length) cmdComboList.children[0].classList.add('active');
	}

	function comboFilter(q){
	  q = (q || '').toLowerCase();
	  if (!q) return COMBO_ALL.slice();
	  var out = [];
	  for (var i=0; i<COMBO_ALL.length; i++){
		var c = COMBO_ALL[i];
		var name = (c.name || '').toLowerCase();
		var id   = (c.id || '').toLowerCase();
		var desc = (c.description || '').toLowerCase();
		if (name.indexOf(q) !== -1 || id.indexOf(q) !== -1 || desc.indexOf(q) !== -1) out.push(c);
	  }
	  return out;
	}

	function comboOpenPanel(){
	  if (comboOpen) return;
	  comboOpen = true;
	  cmdComboBtn.setAttribute('aria-expanded','true');
	  cmdComboPanel.hidden = false;
	  cmdComboSearch.value = '';
	  COMBO_VIEW = COMBO_ALL.slice();
	  comboRenderList(COMBO_VIEW);
	  comboSetButtonLabel();
	  setTimeout(function(){ cmdComboSearch.focus(); }, 0);
	}

	function comboClosePanel(){
	  if (!comboOpen) return;
	  comboOpen = false;
	  cmdComboBtn.setAttribute('aria-expanded','false');
	  cmdComboPanel.hidden = true;
	}

	function comboSelectValue(val){
	  // update hidden/native select and fire change so your code runs
	  select.value = val;
	  var evt = document.createEvent('HTMLEvents');
	  evt.initEvent('change', true, false);
	  select.dispatchEvent(evt);
	  comboSetButtonLabel(val);
	  comboClosePanel();
	}

	function comboEnsureAll(){
	  var data = getCommands() || [];
	  // sort by name
	  var sorted = data.slice().sort(function(a,b){ return (a.name||'').localeCompare(b.name||''); });
	  COMBO_ALL = sorted;
	  COMBO_VIEW = sorted.slice();
	  comboRenderList(COMBO_VIEW);
	  comboSetButtonLabel();
	}
	
	// Open/close via button
	if (cmdComboBtn){
	  cmdComboBtn.addEventListener('click', function(){
		if (comboOpen) comboClosePanel(); else comboOpenPanel();
	  });
	  cmdComboBtn.addEventListener('keydown', function(e){
		if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
		  e.preventDefault(); comboOpenPanel();
		}
	  });
	}

	// Search as you type
	if (cmdComboSearch){
	  cmdComboSearch.addEventListener('input', function(){
		COMBO_VIEW = comboFilter(cmdComboSearch.value);
		comboRenderList(COMBO_VIEW);
	  });
	  cmdComboSearch.addEventListener('keydown', function(e){
		if (!comboOpen) return;
		if (e.key === 'Escape'){ e.preventDefault(); comboClosePanel(); cmdComboBtn.focus(); }
		else if (e.key === 'ArrowDown'){ e.preventDefault(); if (comboActiveIndex < COMBO_VIEW.length-1) { comboActiveIndex++; } highlightActive(); }
		else if (e.key === 'ArrowUp'){ e.preventDefault(); if (comboActiveIndex > 0) { comboActiveIndex--; } highlightActive(); }
		else if (e.key === 'Enter'){ e.preventDefault(); if (COMBO_VIEW[comboActiveIndex]) comboSelectValue(COMBO_VIEW[comboActiveIndex].id || COMBO_VIEW[comboActiveIndex].name); }
	  });
	}

	function highlightActive(){
	  var kids = cmdComboList.children;
	  for (var i=0; i<kids.length; i++) kids[i].classList.remove('active');
	  if (kids[comboActiveIndex]) kids[comboActiveIndex].classList.add('active');
	  // ensure in view
	  var li = kids[comboActiveIndex];
	  if (li && li.scrollIntoView) li.scrollIntoView({ block: 'nearest' });
	}

	// Click to select
	if (cmdComboList){
	  cmdComboList.addEventListener('click', function(e){
		var li = e.target && e.target.closest('li[role="option"]');
		if (!li) return;
		var val = li.getAttribute('data-value');
		comboSelectValue(val);
	  });
	}

// Close when clicking outside
document.addEventListener('click', function(e){
  if (!comboOpen) return;
  if (!cmdCombo.contains(e.target)) comboClosePanel();
});

  function addManualRow(k='',v=''){
    const key = document.createElement('input');
    key.className='input'; key.placeholder='ParameterName'; key.value=k;
    const val = document.createElement('input');
    val.className='input'; val.placeholder='Value'; val.value=v;
    kvManual.appendChild(key); kvManual.appendChild(val);
  }
  document.getElementById('addParam').addEventListener('click', () => addManualRow());

  function findCommand(idOrName){
    const data = getCommands();
    if (!Array.isArray(data)) return null;
    return data.find(c => (c.id===idOrName) || (c.name===idOrName));
  }

  function renderParamSets(cmd){
    setTabsEl.innerHTML = '';
    paramFormEl.innerHTML = '';

    const sets = Array.isArray(cmd.parameterSets) ? cmd.parameterSets : [];
    
    // Filter out any parameter sets that contain a parameter named "InputParameters"
    const filteredSets = (sets || []).filter(s => !(Array.isArray(s.parameters) && s.parameters.some(p => p.name === "InputParameters")));if (!filteredSets.length) {
      paramFormEl.appendChild(document.createTextNode('This command has no structured parameter sets. Use manual generation below or fill only known parameters.'));
      return;
    }

    function renderSet(idx){
      setTabsEl.querySelectorAll('button').forEach((b,i)=> b.classList.toggle('is-active', i===idx));
      const set = filteredSets[idx];
      paramFormEl.innerHTML = '';
      const req = (Array.isArray(set.parameters) ? set.parameters.filter(p => !!p.required) : []);
      const opt = (Array.isArray(set.parameters) ? set.parameters.filter(p => !p.required) : []);

      const mkField = (p) => {
  const wrap = document.createElement('div');
  const id = `p_${Date.now()}_${Math.random().toString(36).slice(2)}`;

  const label = document.createElement('label');
  label.className='label';
  label.setAttribute('for',id);
  label.textContent = p.name + (p.required ? ' *' : '');

  const hint = document.createElement('div');
  hint.className='note';
  hint.textContent = p.description || '';

  let input;

  // Decide if this is a switch/flag parameter
  var t = String(p.type || '').toLowerCase();
  var hasValidate = Array.isArray(p.validateSet) && p.validateSet.length > 0;
  var isSwitch = (
      t === 'switch' ||
      t === 'switchparameter' ||
      t === 'bool' ||
      t === 'boolean' ||
      (t === '' && !hasValidate)  // many of your flags have empty type
  );

  if (isSwitch) {
    input = document.createElement('input');
    input.type = 'checkbox';
    input.id = id;
    if (!hint.textContent) hint.textContent = 'Switch/flag — checked = include this parameter';
  } else if (hasValidate) {
    input = document.createElement('select');
    input.className='input';
    input.id=id;
    const empty = document.createElement('option'); empty.value=''; empty.textContent='—';
    input.appendChild(empty);
    p.validateSet.forEach(function(v){
      const o=document.createElement('option'); o.value=v; o.textContent=v; input.appendChild(o);
    });
  } else {
    input = document.createElement('input');
    input.className='input';
    input.id=id;
    input.placeholder=p.type || 'value';
  }

  input.dataset.paramName = p.name;
  input.dataset.required = p.required ? '1':'0';

  wrap.appendChild(label);
  wrap.appendChild(input);
  if (hint.textContent) wrap.appendChild(hint);
  return wrap;
};

      if (req.length) {
        const h = document.createElement('h4'); h.textContent='Required'; h.className='muted';
        paramFormEl.appendChild(h);
        const grid = document.createElement('div'); grid.className='fields';
        req.forEach(p => grid.appendChild(mkField(p)));
        paramFormEl.appendChild(grid);
      }
      if (opt.length) {
        const div = document.createElement('div'); div.className='divider-strong'; paramFormEl.appendChild(div);
        const h = document.createElement('h4'); h.textContent='Optional'; h.className='muted';
        paramFormEl.appendChild(h);
        const grid = document.createElement('div'); grid.className='fields';
        opt.forEach(p => grid.appendChild(mkField(p)));
        paramFormEl.appendChild(grid);
      }
    }

    filteredSets.forEach((s,i) => {
      const b = document.createElement('button');
      b.type='button'; b.className='btn btn-chip'; b.textContent = s.name || `Set ${i+1}`;
      b.addEventListener('click', () => renderSet(i));
      setTabsEl.appendChild(b);
    });
    if (filteredSets.length) { renderSet(0); }}

  select.addEventListener('change', () => {
    const id = select.value;
    const cmd = findCommand(id);
    if (cmd) renderParamSets(cmd);
  });

  // ---- Step 3: Generate & Typewriter ----
  const btnGenerate = $('#btnGenerate');
  const btnReset = $('#btnReset');
  const outPre = $('#scriptOut');
  const status = $('#genStatus');
  const copyBtn = $('#copyBtn');

  function quote(v){
    if (v === '' || v === null || v === undefined) return '""';
    if (typeof v === 'boolean') return v ? '$true' : '$false';
    if (!isNaN(v)) return String(v);
    const t = String(v).trim();
    if (t.startsWith('@{') || t.startsWith('@(')) return t;
    return `'${String(v).replace(/'/g, "''")}'`;
  }

  function buildAuthSnippet(){
	  var pvwaEl = document.getElementById('pvwa');
	  var identityEl = document.getElementById('identityUrl');
	  var idpEl = document.getElementById('idpLogin');
	  var pvwa = (pvwaEl && pvwaEl.value ? pvwaEl.value : '').trim();
	  var pvwaVal = pvwa;

	  var auth = (typeof activeAuth === 'string' ? activeAuth : '').trim();
	  var aLower = auth.toLowerCase();

	  var idUrl = (identityEl && identityEl.value ? identityEl.value : '').trim();
	  var idp   = (idpEl && idpEl.value ? idpEl.value : '').trim();

	  var flags = [];
	  var noSSL = document.getElementById('optNoSSL');
	  var hideAscii = document.getElementById('optHideAscii');
	  var cookie = document.getElementById('optCookie');
	  var textRec = document.getElementById('optTextRec');
	  var hideWarn = document.getElementById('optHideWarn');
	  if (noSSL && noSSL.checked) flags.push('-NoSSL');
	  if (hideAscii && hideAscii.checked) flags.push('-HideAscii');
	  if (cookie && cookie.checked) flags.push('-InitiateCookie');
	  if (textRec && textRec.checked) flags.push('-TextRecorder');
	  if (hideWarn && hideWarn.checked) flags.push('-HideWarnings');

	  var lines = [];
	  lines.push("Import-Module VpasModule");
	  lines.push("");
	  lines.push("$creds = Get-Credential");

	  var cmd = "New-VPASToken -PVWA '" + pvwaVal + "' -AuthType " + quote(auth) + " -creds $creds";
	  if (aLower === 'saml')            cmd += ' -IDPLogin ' + quote(idp);
	  if (aLower.indexOf('ispss') === 0) cmd += ' -IdentityURL ' + quote(idUrl);
	  if (flags.length) cmd += " " + flags.join(" ");

	  lines.push("$token = " + cmd);
	  lines.push("if(!$token){");
	  lines.push('    Write-Host "FAILED TO AUTHENTICATE INTO CYBERARK" -ForegroundColor Red');
	  lines.push('    return $false');
	  lines.push("}");
	  lines.push("");
	  
	  return lines.join("\n");
	}

  function buildCommandLine(){
	  // If COMMANDS UI is visible, build from the selected command/set
	  var data = getCommands();
	  var useStructured = Array.isArray(data) && data.length && paramSetsEl.style.display !== 'none';

	  if (useStructured) {
		var cmd = findCommand(select.value);
		if (!cmd) return '';

		var name = cmd.name || cmd.id;

		// Use parameterSets (or sets), but hide any set containing "InputParameters"
		var allSets = Array.isArray(cmd.parameterSets) ? cmd.parameterSets
				  : (Array.isArray(cmd.sets) ? cmd.sets : []);
		var filteredSets = (allSets || []).filter(function(s){
		  return !(Array.isArray(s.parameters) && s.parameters.some(function(p){ return p.name === "InputParameters"; }));
		});
		if (!filteredSets.length) return name;

		// Infer active set from rendered inputs (robust even if tab class changes)
		var inputs = Array.prototype.slice.call(document.querySelectorAll('#paramForm [data-param-name]'));
		var visibleNames = {};
		for (var i=0;i<inputs.length;i++){
		  var n = inputs[i].getAttribute('data-param-name');
		  if (n) visibleNames[n] = true;
		}
		var activeSet = filteredSets[0];
		if (filteredSets.length > 1 && inputs.length){
		  var bestIdx = 0, bestScore = -1;
		  for (var s=0; s<filteredSets.length; s++){
			var plist = (filteredSets[s].parameters || []);
			var score = 0;
			for (var k=0; k<plist.length; k++){
			  if (visibleNames[plist[k].name]) score++;
			}
			if (score > bestScore){ bestScore = score; bestIdx = s; }
		  }
		  activeSet = filteredSets[bestIdx] || activeSet;
		}

		// Build args in this set’s parameter order
		var params = Array.isArray(activeSet.parameters) ? activeSet.parameters : [];
		var kv = [];

		function getEl(paramName){
		  return document.querySelector('#paramForm [data-param-name="'+ paramName +'"]');
		}

		for (var j=0; j<params.length; j++){
		  var p = params[j];
		  var el = getEl(p.name);
		  var required = !!p.required;

		  if (el){
			if (el.tagName === 'SELECT'){
			  var sv = (el.value || '').trim();
			  if (sv){
				kv.push([p.name, quote(sv)]);
			  } else if (required){
				kv.push([p.name, '""']); // required but blank
			  }
			} else if (el.type === 'checkbox'){
			  // Switch: include only when checked
			  if (el.checked) kv.push([p.name, null]);
			} else {
			  var tv = (el.value || '').trim();
			  if (tv){
				kv.push([p.name, quote(tv)]);
			  } else if (required){
				kv.push([p.name, '""']); // required but blank
			  }
			}
		  } else {
			// No control rendered; include placeholder if required
			if (required) kv.push([p.name, '""']);
		  }
		}

		var args = kv.map(function(pair){
		  return (pair[1] == null) ? ('-' + pair[0]) : ('-' + pair[0] + ' ' + pair[1]);
		}).join(' ');

		// Mimic first example's prefix, if available (e.g., "$CreateAccountJSON = ")
		var prefix = '';
		try {
		  if (activeSet.examples && activeSet.examples.length && activeSet.examples[0] && typeof activeSet.examples[0].code === 'string'){
			var ex = activeSet.examples[0].code.trim();
			var idx = ex.indexOf(name);
			if (idx > 0){
			  prefix = ex.slice(0, idx);
			  if (prefix.length && !/\s$/.test(prefix)) prefix += ' ';
			}
		  }
		} catch (e) { /* ignore */ }

		return (prefix ? prefix : '') + name + (args ? (' ' + args) : '');
	  }

	  // --- Manual fallback (unchanged) ---
	  var name = ($('#manualName') && $('#manualName').value ? $('#manualName').value.trim() : '') || 'Get-VPASAllSafes';
	  var kv = [];
	  var inputs = Array.prototype.slice.call(kvManual.querySelectorAll('.input'));
	  for (var i=0; i<inputs.length; i+=2){
		var k = ((inputs[i] && inputs[i].value) ? inputs[i].value : '').trim();       // no optional chaining
		var v = ((inputs[i+1] && inputs[i+1].value) ? inputs[i+1].value : '').trim(); // no optional chaining
		if (k) kv.push([k, quote(v)]);
	  }
	  var args = kv.map(function(pair){
		  return (pair[1] == null) ? ('-' + pair[0]) : ('-' + pair[0] + ' ' + pair[1]);
		}).join(' ');
	  
	  return (name + (args ? (' ' + args) : '')).trim();
	}
  
	function buildFooter(){
	  // Customize these lines as you like
	  var lines = [];
	  lines.push('<#...');
	  lines.push('    Depending on what the command returns, the output variable can be the following (but not limited to):');
	  lines.push('        1) $true or $false if the command returns a true value or a false value, typically with the Remove type commands');
	  lines.push('');
	  lines.push('        2) an object which fields can referenced as $VariableName.fieldname if the command returns a single object');
	  lines.push('            - for example $VariableName.safename');
	  lines.push('                *typically with Add type commands or Get single type commands');
	  lines.push('');
	  lines.push('        3) a JSON or set of objects if the command returns multiple objects.');
	  lines.push('            - These returns should be used in a for loop by referencing $VariableName.value');
	  lines.push('            - For most commands use $VariableName.value, but there are exceptions');
	  lines.push('                *typically with Get multiple type commands');
	  lines.push('...#>');
	  lines.push('');
	  lines.push('Remove-VPASToken -token $token')
	  return lines.join('\n');
	}

  function typeWrite(targetEl, text, speed=3){
    targetEl.textContent = '';
    let i = 0;
    const cursor = document.createElement('span');
    cursor.className='cursor';
    targetEl.appendChild(cursor);
    const tick = () => {
      if (i >= text.length) { cursor.remove(); return; }
      const ch = text[i++];
      cursor.insertAdjacentText('beforebegin', ch);
      setTimeout(tick, speed);
    };
    tick();
  }

  btnGenerate.addEventListener('click', () => {
    const auth = buildAuthSnippet();
    const line = buildCommandLine();
    const tail = buildFooter();
	const script = `${auth}\n${line}${tail ? '\n' + tail : ''}`;
    status.textContent = 'Generating…';
    typeWrite(outPre, script, 2);
    setTimeout(() => status.textContent = 'Done ✓', Math.min(1200, script.length*2+200));
  });

  btnReset.addEventListener('click', () => {
    outPre.textContent = '';
    status.textContent = '';
  });

  copyBtn.addEventListener('click', async () => {
    try { await navigator.clipboard.writeText(outPre.textContent); copyBtn.classList.add('copied'); setTimeout(()=>copyBtn.classList.remove('copied'), 800); }
    catch(e){ /* ignore */ }
  });

  // Init
  ensureCommandOptions();
  if (select.options.length) { select.selectedIndex = 0; const cmd = findCommand(select.value); if (cmd) renderParamSets(cmd); }
}
)();
</script>
</body>
</html>
